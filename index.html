<!DOCTYPE html>
<html>
<head>
  <title>Interactive 3D Graph</title>
  <style>
    body {
      margin: 0;
      overflow: hidden; /* Prevent scroll bars */
    }
    #3d-graph {
      width: 100vw;
      height: 100vh;
      background-color: #000;
    }
  </style>

  <!-- Main library for the 3D force graph -->
  <script src="//cdn.jsdelivr.net/npm/3d-force-graph"></script>
</head>

<body>
  <div id="3d-graph"></div>

  <script type="module">
    // Import a library for creating 3D text labels
    import SpriteText from "https://esm.sh/three-spritetext";

    // Fetch the graph data from the nodePositions.json file
    fetch('nodePositions.json')
      .then(response => {
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }
        return response.json();
      })
      .then(rawNodeData => {
        // Transform the raw data into the format required by 3d-force-graph
        const transformedData = {
          nodes: [],
          links: []
        };

        // Populate the nodes and links arrays
        rawNodeData.forEach(item => {
          // Add each item as a node, using 'label' as the display name
          // and assigning a 'group' for automatic coloring
          transformedData.nodes.push({
            id: item.id,
            name: item.label,
            group: item.parent ? 2 : 1
          });

          // If the node has a parent, create a link
          if (item.parent) {
            transformedData.links.push({
              source: item.parent,
              target: item.id
            });
          }
        });
        
        // Initialize the 3D Force Graph with the transformed data
        const Graph = new ForceGraph3D(document.getElementById('3d-graph'))
          .graphData(transformedData)
          .nodeAutoColorBy('group')
          .nodeThreeObject(node => {
            const sprite = new SpriteText(node.name || node.id);
            sprite.material.depthWrite = false;
            sprite.color = node.color;
            sprite.textHeight = 8;
            return sprite;
          })
          .nodeThreeObjectExtend(true)
          .linkWidth(1);

        // Adjust the force strength to spread nodes out a little more
        Graph.d3Force('charge').strength(-250);
      })
      .catch(error => {
        console.error("Failed to load graph data:", error);
      });
  </script>
</body>
</html>
